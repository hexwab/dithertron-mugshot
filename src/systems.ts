const NTSC_cb = 315e6/88; // ~3.58MHz colorburst
const PAL_cb = 283.75 * 15625 + 25; // ~4.433MHz colorburst

// returns the pixel aspect ratio for a given pixel clock
function aspect_PAL (clk) {
    return 4/3 * 575 / 51.95 * 1e6 / clk / 2;
}
function aspect_NTSC (clk) {
    return 13.5*10/11*1e6/clk/2;
}

const SYSTEMS : DithertronSettings[] = [
    {
        id:'c64.multi',
        name:'C-64 Multi',
        width:160,
        height:200,
        scaleX:aspect_PAL(PAL_cb*8/9),
	pxclk: PAL_cb*8/9,
        //scaleX:aspect_NTSC(NTSC_cb*6/7),
        conv:'VICII_Multi_Canvas',
        pal:VIC_NTSC_RGB,
        block:{w:4,h:8,colors:4},
        toNative:'exportC64Multi',
    },
    {
        id:'c64.hires',
        name:'C-64 Hires',
        width:320,
        height:200,
        scaleX:aspect_PAL(PAL_cb*16/9),
	pxclk: PAL_cb*16/9,
        //scaleX:aspect_NTSC(NTSC_cb*12/7),
        conv:'ZXSpectrum_Canvas',
        pal:VIC_NTSC_RGB,
        block:{w:8,h:8,colors:2},
        toNative:'exportC64Hires',
    },
    {
        id:'nes',
        name:'NES (4 color, 240 tiles)',
        width:160,
        height:96,
        //scaleX:8/7,
	pxclk: NTSC_cb*3/2,
	scaleX:aspect_NTSC(NTSC_cb*3/2),
        conv:'DitheringCanvas',
        pal:NES_RGB,
        reduce:4,
        toNative:'exportNES',
    },
    {
        id:'msx',
        name:'MSX/Coleco (TMS9918A)',
        width:256,
        height:192,
        conv:'VDPMode2_Canvas',
        pal:TMS9918_RGB,
        block:{w:8,h:1,colors:2},
        toNative:'exportTMS9918',
    },
    {
        id:'apple2.hires',
        name:'Apple ][ Hires',
        width:140,
        height:192,
        //scaleX:2,
	pxclk: NTSC_cb,
	scaleX:aspect_NTSC(NTSC_cb),
        conv:'Apple2_Canvas',
        pal:AP2HIRES_RGB,
        block:{w:7,h:1,colors:4},
        toNative:'exportApple2HiresToHGR',
    },
    {
        id:'atari8.d',
        name:'Atari ANTIC D',
        width:160,
        height:96,
        scaleX:aspect_NTSC(NTSC_cb*2),
	pxclk: NTSC_cb*2,
        conv:'DitheringCanvas',
        pal:VCS_RGB,
        reduce:4,
        toNative:'exportFrameBuffer',
        exportFormat:{bpp:2,brev:true},
    },
    {
        id:'vcs',
        name:'Atari VCS',
        width:40,
        height:192,
        scaleX:6,
        conv:'DitheringCanvas',
        pal:VCS_RGB,
        reduce:2,
        toNative:'exportVCSPlayfield',
    },
    {
        id:'astrocade',
        name:'Bally Astrocade',
        width:160,
        height:98,
        scaleX:1,
        conv:'DitheringCanvas',
        pal:ASTROCADE_RGB,
        reduce:4,
        toNative:'exportFrameBuffer',
        exportFormat:{bpp:2,brev:true},
    },
    {
        id:'zx',
        name:'ZX Spectrum',
        width:256,
        height:192,
        conv:'ZXSpectrum_Canvas',
	scaleX:aspect_PAL(7e6),
	pxclk:7e6,
        pal:ZXSPECTRUM_RGB,
        block:{w:8,h:8,colors:2},
        toNative:'exportZXSpectrum',
    },

    null,
    
    {
        id:'nes4f',
        name:'NES (4 color, full screen)',
        width:256,
        height:240,
	scaleX:aspect_NTSC(NTSC_cb*3/2),
	pxclk:NTSC_cb*3/2,
        conv:'DitheringCanvas',
        pal:NES_RGB,
        reduce:4,
        toNative:'exportNES',
    },
    {
        id:'nes5f',
        name:'NES (5 color, full screen)',
        width:256,
        height:240,
	scaleX:aspect_NTSC(NTSC_cb*3/2),
	pxclk:NTSC_cb*3/2,
        conv:'NES_Canvas',
        pal:NES_RGB,
        reduce:5,
        toNative:'exportNES',
    },
    {
        id:'atari7800.160a',
        name:'Atari 7800 (160A)',
        width:160,
        height:240,
//        scaleX:2,
	scaleX:aspect_NTSC(NTSC_cb),
	pxclk:NTSC_cb,
        conv:'DitheringCanvas',
        pal:VCS_RGB,
        reduce:4,
    },
    {
        id:'atari7800.160b',
        name:'Atari 7800 (160B)',
        width:160,
        height:240,
	scaleX:aspect_NTSC(NTSC_cb),
	pxclk:NTSC_cb,
        conv:'DitheringCanvas',
        pal:VCS_RGB,
        reduce:12,
    },
    {
        id:'sms',
        name:'Sega Master System',
        width:176, // only 488 unique tiles max, otherwise 256x240
        height:144,
        scaleX:8/7,
        conv:'DitheringCanvas',
        pal:SMS_RGB,
        reduce:16,
    },
    {
        id:'bbcmicro.mode0',
        name:'BBC Micro (mode 0)',
        width:640,
        height:256,
	scaleX:0.48,//aspect_PAL(16e6),
	pxclk:16e6,
        conv:'DitheringCanvas',
        pal:TELETEXT_RGB,
	reduce:2,
        toNative:'exportFrameBuffer',
	exportFormat:{bpp:1,yinter:8,brev:true},
    },
    {
        id:'bbcmicro.mode0.overscan',
        name:'BBC Micro (mode 0)',
        width:832,
        height:288,
	scaleX:0.48,//aspect_PAL(16e6),
	pxclk:16e6,
        conv:'DitheringCanvas',
        pal:TELETEXT_RGB,
	reduce:2,
        toNative:'exportFrameBuffer',
	exportFormat:{bpp:1,yinter:8,brev:true},
    },
    {
        id:'bbcmicro.mode1',
        name:'BBC Micro (mode 1)',
        width:320,
        height:256,
	scaleX:0.96,//aspect_PAL(8e6),
	pxclk:8e6,
        conv:'DitheringCanvas',
        pal:TELETEXT_RGB,
	reduce:4,
        toNative:'exportFrameBuffer',
	exportFormat:{bpp:2,yinter:8,bitremap:[3,7,2,6,1,5,0,4]},
    },
    {
        id:'bbcmicro.mode1.overscan',
        name:'BBC Micro (mode 1)',
        width:416,
        height:288,
	scaleX:0.96,//aspect_PAL(8e6),
	pxclk:8e6,
        conv:'DitheringCanvas',
        pal:TELETEXT_RGB,
	reduce:4,
        toNative:'exportFrameBuffer',
	exportFormat:{bpp:2,yinter:8,bitremap:[3,7,2,6,1,5,0,4]},
    },
    {
        id:'bbcmicro.mode2',
        name:'BBC Micro (mode 2)',
        width:160,
        height:256,
	scaleX:1.92,//aspect_PAL(4e6),
	pxclk:4e6,
        conv:'DitheringCanvas',
        pal:TELETEXT_RGB,
        toNative:'exportFrameBuffer',
	exportFormat:{bpp:4,yinter:8,bitremap:[1,3,5,7,0,2,4,6]},
    },
    {
        id:'bbcmicro.mode2.overscan',
        name:'BBC Micro (mode 2)',
        width:208,
        height:288,
	scaleX:1.92,//aspect_PAL(4e6),
	pxclk:4e6,
        conv:'DitheringCanvas',
        pal:TELETEXT_RGB,
        toNative:'exportFrameBuffer',
	exportFormat:{bpp:4,yinter:8,bitremap:[1,3,5,7,0,2,4,6]},
    },
    {
        id:'bbcmicro.mode4',
        name:'BBC Micro (mode 4)',
        width:320,
        height:256,
	scaleX:0.96,//aspect_PAL(8e6),
	pxclk:8e6,
        conv:'DitheringCanvas',
        pal:TELETEXT_RGB,
	reduce:2,
        toNative:'exportFrameBuffer',
	exportFormat:{bpp:1,yinter:8,brev:true},
    },
    {
        id:'bbcmicro.mode5',
        name:'BBC Micro (mode 5)',
        width:160,
        height:256,
	scaleX:1.92,//aspect_PAL(4e6),
	pxclk:4e6,
        conv:'DitheringCanvas',
        pal:TELETEXT_RGB,
	reduce:4,
        toNative:'exportFrameBuffer',
	exportFormat:{bpp:2,yinter:8,bitremap:[3,7,2,6,1,5,0,4]},
    },
    {
        id:'bbcmicro.mode8',
        name:'BBC Micro ("mode 8")',
        width:80,
        height:256,
	scaleX:3.84,//aspect_PAL(2e6),
	pxclk:2e6,
        conv:'DitheringCanvas',
        pal:TELETEXT_RGB,
        toNative:'exportFrameBuffer',
	exportFormat:{bpp:4,yinter:8,bitremap:[1,3,5,7,0,2,4,6]},
    },
    {
        id:'cpc.mode0',
        name:'Amstrad CPC (mode 0)',
        width:160,
        height:200,
        scaleX:15/8, // CHECKME
        conv:'DitheringCanvas',
        pal:AMSTRAD_CPC_RGB,
        reduce:16,
    },
    {
        id:'cpc.mode1',
        name:'Amstrad CPC (mode 1)',
        width:320,
        height:200,
        scaleX:15/16, // CHECKME
        conv:'DitheringCanvas',
        pal:AMSTRAD_CPC_RGB,
        reduce:4,
    },
    {
        id:'cpc.mode2',
        name:'Amstrad CPC (mode 2)',
        width:640,
        height:200,
        scaleX:15/32, // CHECKME
        conv:'DitheringCanvas',
        pal:AMSTRAD_CPC_RGB,
        reduce:2,
    },
    {
        id:'apple2.dblhires',
        name:'Apple ][ Double-Hires',
        width:140,
        height:192,
	scaleX:aspect_NTSC(NTSC_cb),
	pxclk:NTSC_cb,
        conv:'DitheringCanvas',
        pal:AP2LORES_RGB,
    },
    {
        id:'apple2.lores',
        name:'Apple ][ Lores',
        width:40,
        height:48,
	scaleX:aspect_NTSC(NTSC_cb*2/7*4),
	pxclk:NTSC_cb*2/7,
        conv:'DitheringCanvas',
        pal:AP2LORES_RGB,
        toNative:'exportFrameBuffer',
        exportFormat:{bpp:4},
    },
    {
        id:'channelf',
        name:'Fairchild Channel F',
        width:102,
        height:58,
        conv:'DitheringCanvas',
        pal:CHANNELF_RGB,
        //reduce:4, // TODO: https://geeks-world.github.io/articles/467811/index.html
    },
    {
        id:'mac',
        name:'Mac 128K',
        width:512,
        height:342,
        conv:'DitheringCanvas',
        pal:MONO_RGB,
    },
    {
        id:'x86.cga.04h.1',
        name:'PC CGA Mode 04h (palette 1)',
        width:320,
        height:200,
        //scaleX:200/320*1.37,
	scaleX:aspect_NTSC(NTSC_cb*2),
	pxclk:NTSC_cb*2,
        conv:'DitheringCanvas',
        pal:CGA_RGB_1,
        toNative:'exportFrameBuffer',
        exportFormat:{bpp:1,np:2},
    },
    {
        id:'x86.cga.04h.1B',
        name:'PC CGA Mode 04h (bright 1)',
        width:320,
        height:200,
        //scaleX:200/320*1.37,
	scaleX:aspect_NTSC(NTSC_cb*2),
        conv:'DitheringCanvas',
        pal:CGA_RGB_1H,
        toNative:'exportFrameBuffer',
        exportFormat:{bpp:1,np:2},
    },
    {
        id:'x86.cga.04h.2',
        name:'PC CGA Mode 04h (palette 2)',
        width:320,
        height:200,
        //scaleX:200/320*1.37,
	scaleX:aspect_NTSC(NTSC_cb*2),
	pxclk:NTSC_cb*2,
        conv:'DitheringCanvas',
        pal:CGA_RGB_2,
        toNative:'exportFrameBuffer',
        exportFormat:{bpp:1,np:2},
    },
    {
        id:'x86.cga.04h.2B',
        name:'PC CGA Mode 04h (bright 2)',
        width:320,
        height:200,
        //scaleX:200/320*1.37,
	scaleX:aspect_NTSC(NTSC_cb*2),
	pxclk:NTSC_cb*2,
        conv:'DitheringCanvas',
        pal:CGA_RGB_2H,
        toNative:'exportFrameBuffer',
        exportFormat:{bpp:1,np:2},
    },
    {
        id:'x86.cga.05h',
        name:'PC CGA Mode 05h',
        width:320,
        height:200,
        //scaleX:200/320*1.37,
	scaleX:aspect_NTSC(NTSC_cb*2),
	pxclk:NTSC_cb*2,
        conv:'DitheringCanvas',
        pal:CGA_RGB_3,
        toNative:'exportFrameBuffer',
        exportFormat:{bpp:1,np:2},
    },
    {
        id:'x86.cga.05h.B',
        name:'PC CGA Mode 05h (bright)',
        width:320,
        height:200,
        //scaleX:200/320*1.37,
	scaleX:aspect_NTSC(NTSC_cb*2),
	pxclk:NTSC_cb*2,
        conv:'DitheringCanvas',
        pal:CGA_RGB_3H,
        toNative:'exportFrameBuffer',
        exportFormat:{bpp:1,np:2},
    },
    {
        id:'x86.tandy.8',
        name:'PCjr/Tandy Mode 08h',
        width:160,
        height:200,
        //scaleX:200/160*1.37,
	scaleX:aspect_NTSC(NTSC_cb),
	pxclk:NTSC_cb,
        conv:'DitheringCanvas',
        pal:CGA_RGB,
        reduce:16,
    },
    {
        id:'x86.tandy.9',
        name:'PCjr/Tandy Mode 09h',
        width:320,
        height:200,
        //scaleX:200/320*1.37,
	scaleX:aspect_NTSC(NTSC_cb*2),
	pxclk:NTSC_cb*2,
        conv:'DitheringCanvas',
        pal:CGA_RGB,
        reduce:16,
    },
    {
        id:'x86.tandy.a',
        name:'PCjr/Tandy Mode 0Ah',
        width:640,
        height:200,
        //scaleX:200/640*1.37,
	scaleX:aspect_NTSC(NTSC_cb*4),
	pxclk:NTSC_cb*4,
        conv:'DitheringCanvas',
        pal:CGA_RGB,
        reduce:4,
    },
    {
        id:'x86.hercules',
        name:'PC Hercules',
        width:720,
        height:348,
        scaleX:348/720*1.37,
        conv:'DitheringCanvas',
        pal:MONO_RGB,
    },
    {
        id:'x86.ega.0dh',
        name:'PC EGA Mode 0Dh',
        width:320,
        height:200,
        //scaleX:200/320*1.37,
	scaleX:aspect_NTSC(NTSC_cb*2),
	pxclk:NTSC_cb*2,
        conv:'DitheringCanvas',
        pal:CGA_RGB,
        toNative:'exportFrameBuffer',
        exportFormat:{bpp:1,np:4},
    },
    {
        id:'x86.ega.10h',
        name:'PC EGA Mode 10h',
        width:640,
        height:350,
        scaleX:350/640*1.37,
        conv:'DitheringCanvas',
        pal:CGA_RGB,
        toNative:'exportFrameBuffer',
        exportFormat:{bpp:1,np:4},
    },
    {
        id:'williams',
        name:'Williams Arcade',
        width:304,
        height:256,
        conv:'DitheringCanvas',
        pal:WILLIAMS_RGB,
        reduce:16,
    },
    {
        id:'pico8',
        name:'PICO-8',
        width:128,
        height:128,
        aspect:1/1,
        conv:'DitheringCanvas',
        pal:PICO8_RGB,
    },
    {
        id:'tic80',
        name:'TIC-80',
        width:240,
        height:136,
        aspect:30/17,
        conv:'DitheringCanvas',
        pal:TIC80_RGB,
    },
    {
        id:'gb',
        name:'Game Boy Classic',
        width:160,
        height:144,
        scaleX:10/9,
        conv:'DitheringCanvas',
        pal:GAMEBOY_GREEN_RGB,
    },
    /*
    {
        id:'gbc',
        name:'Game Boy Color',
        width:160,
        height:144,
        aspect:1,
        conv:'DitheringCanvas',
        pal:GAMEBOY_COLOR_RGB,
        reduce:32,
    },
    */
];
var SYSTEM_LOOKUP = {};
SYSTEMS.forEach((sys) => { if (sys) SYSTEM_LOOKUP[sys.id||sys.name] = sys; });

